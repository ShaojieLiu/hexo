---
title: 加密货币原理
date: 2019-03-25 19:53:32
tags: crypto
---

# Reference

[参考视频](https://v.youku.com/v_show/id_XMzY3MjIzMTczMg==.html?spm=a2hzp.8244740.0.0)
[参考视频](https://www.youtube.com/watch?v=bBC-nXj3Ng4&t=1301s)

# 引子

> 什么是矿工呢?
> 难道他们不停地挖矿吗?
> {% asset_img miner0.png 矿工挖矿 %}
> 并非如此, 他们使用区块内的所有字符串作为输入(包括它所猜的数字)进行 SHA256 计算, 当结果符合一定条件时(例如开头是 30 个零), 即为成功. 你现在一定有很多疑问, 区块内包含了什么, 他为什么要猜数字, 为什么要不停地进行 hash 计算? 今天的文章或许可以为你带来解答.

{% asset_img miner1.png 数字矿机挖矿 %}

# 从分布式账本说起

> 加密货币 = 分布式账本 + 加密算法

我们先来解决一个很实际的小问题.

假如你和你的三个朋友有频繁的金钱往来, 为了避免现金实时结算带来烦恼, 你们可能会使用一个账本来记录一切未结算的金钱往来.
{% asset_img ledger.png 独立账本 %}

账本的协议如下:

1. 任何人都可以往账本上添加记录
1. 每条记录都需要有效的签名
1. 不能"超花"(使一方的余额变成负数)

### 数字签名

那么我们如何校验数据的合法性呢? 这时候需要数字签名.

一个纸质的账本, 我们可以使用独特的手写笔迹来确认交易记录的合法性. 那么一个数字记录可能没这么直接.

{% asset_img sign0.png 纸质签名 %}

因为你很容易想到, 无论我的签名是多么的独特和高辨识度, 只要它是不改变的, 在计算机上我总可以复制一份一模一样的数据出来.

{% asset_img sign1.png 签名复制 %}

这里面使用了密码学的知识, 需要以下四个概念来理解: 私钥, 公钥, 签名函数, 验证函数. 他们的关系如下图表述:

{% asset_img key0.png 数字签名 %}

它保证了, 没有私钥的人无法得到一个正确的签名. 因此签名通过验证函数时, 你可以确定这个签名是由当事人使用私钥计算出来的, 并且每个签名都是独特的.

### 防止"超花"

为了账本协议的第三条. 账本在添加新纪录的时候需要回溯付款方的所有历史交易记录, 从而得到当前交易记录是否"超花".
"超花"和没有数字签名一样都是不合法的记录.

{% asset_img currency0.png currency %}
所以本质上讲, 每一个数字货币都是一个账本, 而账本里的所有交易记录就可以体现你的当前余额.

### 账本规则的维护

1. 公共账本: 由于账本是公共的, 每个人都可以在上面增加信息, 那么难以避免有人在数据记录上造假, 所以我们需要制造共识(比如每条记录都需要所有参与者同意才可添加, 效率可能就很低), 这种模型我们称之为公共账本.

2. 所以我们需要让某一个人持有这个账本(只有他可以写入), 这个账本放在谁那里好呢? 拥有这个账本的人拥有极大的权力, 所以必须是一个所有人都信任的人, 而且必须是没有利益相关的. 这个模式我们称之为第三方账本, 目前广泛应用, 例如常用的银行, 支付宝, 都是属于大家信任的第三方机构.

3. 还有一种模式, 就是每个人都有一个账本, 然后互相之间同步账本, 这种模式称为"分布式账本".

以上的模式讨论了数据存储与同步的问题, 那么我们如何校验数据的合法性呢? 这时候需要数字签名.
